	/**
	 * Whether this DTO is immutable.
	 */
	protected const IS_IMMUTABLE = {{ immutable ? 'true' : 'false' }};

	/**
	 * Pre-computed setter method names for fast lookup.
	 *
	 * @var array<string, string>
	 */
	protected static array $_setters = [
{% for field in fields %}
		'{{ field.name }}' => '{% if immutable %}with{% else %}set{% endif %}{{ field.name | capitalize }}',
{% endfor %}
	];

{% set fieldsWithDefaults = [] %}
{% for field in fields %}
{% if field.defaultValue is not null %}
{% set fieldsWithDefaults = fieldsWithDefaults | merge([field]) %}
{% endif %}
{% endfor %}

	/**
	 * Optimized setDefaults - only processes fields with default values.
	 *
	 * @return $this
	 */
	protected function setDefaults() {
{% if fieldsWithDefaults | length > 0 %}
{% for field in fieldsWithDefaults %}
		if ($this->{{ field.name }} === null) {
			$this->{{ field.name }} = {{ field.defaultValue | json_encode | raw }};
		}
{% endfor %}
{% endif %}

		return $this;
	}
{% set requiredFields = [] %}
{% for field in fields %}
{% if field.required %}
{% set requiredFields = requiredFields | merge([field]) %}
{% endif %}
{% endfor %}

	/**
	 * Optimized validate - only checks required fields.
	 *
	 * @throws \InvalidArgumentException
	 *
	 * @return void
	 */
	protected function validate(): void {
{% if requiredFields | length > 0 %}
{% set checks = [] %}
{% for field in requiredFields %}
{% set checks = checks | merge(['$this->' ~ field.name ~ ' === null']) %}
{% endfor %}
		if ({{ checks | join(' || ') | raw }}) {
			$errors = [];
{% for field in requiredFields %}
			if ($this->{{ field.name }} === null) {
				$errors[] = '{{ field.name }}';
			}
{% endfor %}
			if ($errors) {
				throw new \InvalidArgumentException('Required fields missing: ' . implode(', ', $errors));
			}
		}
{% endif %}
	}

